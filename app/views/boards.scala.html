@(game: Game)
@main("Conway's Game of Life") {
    <pre id="board"></pre>
    <div id="fps"></div>
    <script type="text/javascript">
            if (typeof(EventSource) === undefined) {
                document.getElementById("board").innerHTML = "Sorry. This browser doesn't seem to support server sent events. Check <a href='http://html5test.com/compare/feature/communication-eventSource.html'>html5test</a> for browser compatibility.";
            } else {
                var source = new EventSource("@Html(routes.GameController.stream(game).toString)");
                var boardTag = document.getElementById("board");
                var fpsTag = document.getElementById("fps");
                var times = [];
                var index = 0;
                times[index++] = performance.now();
                source.addEventListener('message', function (event) {
                    boardTag.innerHTML = event.data;
                    var now = performance.now();
                    times[index] = now;
                    var then = times[(index + 1) % times.length];
                    index = (index + 1) % 100;
                    var fps = 1e3 * times.length / (now - then)
                    fpsTag.innerHTML = "FPS: " + fps.toFixed(1);
                });
                source.addEventListener('close', function (event) {
                    source.close();
                });
            }
    </script>
}
